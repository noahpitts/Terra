<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Title -->
    <title>terra</title>
    <meta name="description" content="Terra Project">
    <meta name="author" content="Noah Pitts">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="./icon/favicon.png">

    <!-- Fonts -->
    <!-- <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro|Source+Serif+Pro" rel="stylesheet"> -->

    <!-- CSS -->
    <link rel="stylesheet" href="./css/terra.css">

    <!-- JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>

    <!-- CODE DISPLAY FUNCTION -->
    <script>
        function displayCode(id) {
            var element = document.getElementById(id);
            if (element.classList.contains("hidden")) {
                element.classList.remove("hidden");
            } else {
                element.classList.add("hidden");
            }
        }
    </script>

</head>

<body>
    <!-- NAVBAR -->
    <nav>
        <ul>
            <li class="nav-title"><a href="#cover" class="nav-title">terra</a></li>
            <li><a href="#glossary">glossary</a></li>
            <li><a href="#annotated-bibliography">bibliography</a></li>
            <li><a href="#site-description">site</a></li>
            <li><a href="#research-methods">methods</a></li>
            <li><a href="#precedent-analysis">precedent</a></li>
            <li><a href="#theoretical-framework">framework</a></li>
            <li><a href="#research-questions-section">questions</a></li>
            <li><a href="#abstract-section">abstract</a></li>
        </ul>
        </div>
    </nav>
    </nav>

    <!-- COVER -->
    <div class="break" id="cover">
        <h1>terra project</h1>
        <blockquote>
            <p>This report outlines the framework for my joint university thesis in Architecture and Landscape
                Architecture at the University of California, Berkeley. The thesis will use techniques in new media and
                machine learning to explore ways that generative design methods of landscape and architectural and
                form. The product of the thesis will be a set of generative adversarial models trained on GIS datasets
                and incorporated into a web-based application for inference and generations of synthetic form. The
                application will explore the potential for expanding methods of digital design practice and integrating
                current AI using conditional inference on the machine learning models through a custom browser-based
                CAD interface.</p>
            <cite><a href="http://www.github.com/noahpitts" target="_blank">Noah Pitts</a></cite>
        </blockquote>
        <!-- <h3>site under construction, please come back soon!!</h3> -->
        <div id="cover-sketch"></div>

        <!-- COVER CODE -->
        <script>
            var cols, rows;
            var scl = 20;
            var w = 1200;
            var h = 700;

            var flying = 0;

            var terrain = [];

            function setup() {
                var canvas = createCanvas(1200, 300, WEBGL);
                canvas.parent('cover-sketch');
                cols = w / scl;
                rows = h / scl;

                for (var x = 0; x < cols; x++) {
                    terrain[x] = [];
                    for (var y = 0; y < rows; y++) {
                        terrain[x][y] = 0;
                    }
                }
            }

            function draw() {
                flying -= 0.05;
                var yoff = flying;
                for (var y = 0; y < rows; y++) {
                    var xoff = 0;
                    for (var x = 0; x < cols; x++) {
                        terrain[x][y] = map(noise(xoff, yoff), 0, 1, -100, 100);
                        xoff += 0.2;
                    }
                    yoff += 0.2;
                }

                background(30, 30, 30);
                stroke(100, 100, 100);
                strokeWeight(1.5);
                translate(0, 50);
                rotateX(PI / 3);
                fill(30, 30, 30);

                translate(-w / 2, -h / 2);

                for (var y = 0; y < rows - 1; y++) {
                    beginShape(TRIANGLE_STRIP);
                    for (var x = 0; x < cols; x++) {
                        vertex(x * scl, y * scl, terrain[x][y]);
                        vertex(x * scl, (y + 1) * scl, terrain[x][y + 1]);
                    }
                    endShape();
                }
            }
        </script>

        <div class="code-cite">
            <a class="code-cite" onclick="displayCode('cover-code')">code</a>
        </div>

        <!-- Generated from: http://hilite.me/ -->

        <div class="code hidden" id="cover-code">
            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <table>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">cols,</span> <span style="color: #d0d0d0">rows;</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">scl</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">20</span><span style="color: #d0d0d0">;</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1200</span><span style="color: #d0d0d0">;</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">800</span><span style="color: #d0d0d0">;</span>

<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">flying</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span>

<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">terrain</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[];</span>

<span style="color: #6ab825; font-weight: bold">function</span> <span style="color: #d0d0d0">setup()</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">canvas</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">createCanvas(</span><span style="color: #3677a9">1200</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">WEBGL);</span>
  <span style="color: #d0d0d0">canvas.parent(</span><span style="color: #ed9d13">&#39;cover-sketch&#39;</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">cols</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">/</span> <span style="color: #d0d0d0">scl;</span>
  <span style="color: #d0d0d0">rows</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h/</span> <span style="color: #d0d0d0">scl;</span>

  <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">(</span><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">cols;</span> <span style="color: #d0d0d0">x++)</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">terrain[x]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[];</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">(</span><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">rows;</span> <span style="color: #d0d0d0">y++)</span> <span style="color: #d0d0d0">{</span>
      <span style="color: #d0d0d0">terrain[x][y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span>
    <span style="color: #d0d0d0">}</span>
  <span style="color: #d0d0d0">}</span>
<span style="color: #d0d0d0">}</span>

<span style="color: #6ab825; font-weight: bold">function</span> <span style="color: #d0d0d0">draw()</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #d0d0d0">flying</span> <span style="color: #d0d0d0">-=</span> <span style="color: #3677a9">0.05</span><span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">yoff</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">flying;</span>
  <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">(</span><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">rows;</span> <span style="color: #d0d0d0">y++)</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">xoff</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">(</span><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">cols;</span> <span style="color: #d0d0d0">x++)</span> <span style="color: #d0d0d0">{</span>
      <span style="color: #d0d0d0">terrain[x][y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">map(noise(xoff,</span> <span style="color: #d0d0d0">yoff),</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">100</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">100</span><span style="color: #d0d0d0">);</span>
      <span style="color: #d0d0d0">xoff</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">0.2</span><span style="color: #d0d0d0">;</span>
    <span style="color: #d0d0d0">}</span>
    <span style="color: #d0d0d0">yoff</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">0.2</span><span style="color: #d0d0d0">;</span>
  <span style="color: #d0d0d0">}</span>

  <span style="color: #d0d0d0">background(</span><span style="color: #3677a9">30</span><span style="color: #d0d0d0">,</span><span style="color: #3677a9">30</span><span style="color: #d0d0d0">,</span><span style="color: #3677a9">30</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">stroke(</span><span style="color: #3677a9">100</span><span style="color: #d0d0d0">,</span><span style="color: #3677a9">100</span><span style="color: #d0d0d0">,</span><span style="color: #3677a9">100</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">strokeWeight(</span><span style="color: #3677a9">1.5</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">translate(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">50</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">rotateX(PI/</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">fill(</span><span style="color: #3677a9">30</span><span style="color: #d0d0d0">,</span><span style="color: #3677a9">30</span><span style="color: #d0d0d0">,</span><span style="color: #3677a9">30</span><span style="color: #d0d0d0">);</span>
  
  <span style="color: #d0d0d0">translate(-w/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">-h/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">);</span>

  <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">(</span><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">rows-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">y++)</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">beginShape(TRIANGLE_STRIP);</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">(</span><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">cols;</span> <span style="color: #d0d0d0">x++)</span> <span style="color: #d0d0d0">{</span>
      <span style="color: #d0d0d0">vertex(x*scl,</span> <span style="color: #d0d0d0">y*scl,</span> <span style="color: #d0d0d0">terrain[x][y]);</span>
      <span style="color: #d0d0d0">vertex(x*scl,</span> <span style="color: #d0d0d0">(y+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*scl,</span> <span style="color: #d0d0d0">terrain[x][y+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]);</span>
    <span style="color: #d0d0d0">}</span>
    <span style="color: #d0d0d0">endShape();</span>
  <span style="color: #d0d0d0">}</span>
<span style="color: #d0d0d0">}</span>
</pre>
                        </td>
                    </tr>
                </table>
            </div>

        </div>
    </div>

    <!-- ABSTRACT -->
    <div class="break" id="abstract-section">
        <h2>abstact</h2>
        <section>
            <p>Research in Artificial Intelligence and Machine Learning has entered a phase of rapid growth over the
                past decade and with the inclusion of abundant data sources and deep networks, new models are being
                proposed on the timespan of weeks rather than years. Until recently, machine learning goals were
                primarily focused on inference rather than the generation of data. However, with the inclusion of
                generative algorithms into the arsenal of AI technologies and the inevitable adoption of such
                techniques into the design professions, it becomes necessary to consider the role in which AI may
                affect the profession and the processes of design itself.</p>

            <p>A common ML paradigm would take a set of features, 𝑋, and learn to produce a label, 𝑌, describing
                those features. A generative network reverses this logic, taking in a label, 𝑌, potentially random,
                and producing a set of features, 𝑍, that on the training limit is indistinguishable from a training
                dataset, while not from the dataset. The output of a generative model is an entirely synthetic creation
                with similar structure to the training data, based on the parameters tuned through a learning process.
                In 2014, Ian Goodfellow proposed the seminal model for Generative Adversarial Networks1 or GANs, a
                class of machine learning models that learns to create through the implementation of zero-sum game
                theory. In this paradigm, two networks are paired against each other, one acting as a generator for
                data samples, the other acting as a discriminator, probabilistically evaluating whether the generated
                sample is of the training data or is generated.</p>

            <p>The invention of GANs has already begun to show significant promise in the generation of synthetic
                images trained on canonical ML training data.2 However, at the present, there has been little
                application (at least published) of these tools to real world examples in the design professions such
                as architecture, either exploring the potentials for design exploration or for more directed design
                problem solving. The intent of this thesis is to implement a series of GANs3 to explore the relevance
                and potential for incorporation in to the future of design practice. While GANs are still in an
                extremely early area of research and development, I will be using them to ask fundamental questions of
                artificial architectural expression such as synthetic tectonics, phenomenology, and representation.</p>
        </section>
    </div>

    <!-- RESEARCH QUESTIONS -->
    <div class="break" id="research-questions-section">
        <h2>research questions</h2>
        <section>
            <p>The overarching question is what role and potential capacity generative adversarial networks can play in
                the inclusion of artificial intelligence and machine learning in design.5 This question is
                intentionally framed to be exploratory and inductive rather than deductive. The intent is to frame the
                technology within the discourse of design theory rather than to attempt to solve a particular design
                problem.6 A list of initial sub questions, both theoretical and technical, are expressed below:</p>

            <ul>
                <li>What tools and frameworks are required to implement a GAN (tensorflow, keras, scikit-learn, etc.)?
                </li>
                <li>What data forms and structures (images, geometry, text) are able to be utilized with a GAN?</li>
                <li>What are some of the potential sources for training data (generated data and/or collected data)?
                </li>
                <li>What is the timescale for training a generative model and how does this scale with more complex
                    types of data? </li>
                <li>What is the timescale for inference and sampling (after the model is trained) and how does this
                    incorporate with other design applications? </li>
                <li>What forms of media are relevant to the inclusion of a generative model (CAD, VR/AR, Raster,
                    Vector, etc)? </li>
                <li>What is an analogous framework for evaluating the application of a technology to a design theory
                    (what are historical examples of how early technology has been brought into practice)? </li>
                <li>Given some clarification from previous questions, what are a set of case-studies/demos that can be
                    implemented within a reasonable time while still providing validation of the model (either positive
                    or negative)?</li>
                <li>What are the key metrics, if any, that can be used (or borrowed from core ML research) for
                    validation and how are these appropriated into design theory. </li>
                <li>Given that the scope of this inquiry will be limited and using a posteriori methodology, what are
                    the gaps in knowledge, and where are the areas and potential for further research?</li>
            </ul>
        </section>
    </div>

    <!-- THEORETICAL FRAMEWORK -->
    <div class="break" id="theoretical-framework">
        <h2>theoretical framework</h2>
        <section>
            <blockquote>
                <p>Generative design is an iterative design process that involves a program that will generate a certain number of outputs that meet certain constraints, and a designer that will fine tune the feasible region by changing minimal and maximal values of an interval in which a variable of the program meets the set of constraints, in order to reduce or augment the number of outputs to choose from. The program doesn't need to be run on a machine like a digital computer, it can be run by a human for example with pen and paper. The designer doesn't need to be a human, it can be a test program in a testing environment or an artificial intelligence. The designer learns to refine the program with each iteration as his design goals become better defined over time.</p>
                <cite><a href="https://en.wikipedia.org/wiki/Generative_design" target="_blank">Wikipedia</a></cite>
            </blockquote>

            <br/>
            <br/>

            <p>With the rising use of computational techniques across many disiplines, generative design is becoming a signiifcant strategy in the design professions. Traditionally generative strategies have relied on discrete computational methods analogous to more process driven techniques, although substituting the redundant operations with more complicated procedures. In some cases such as the use of genetic algorithms, substantial computation is dedicated to the iterative processes that are required. Similar to the computational advances that are taking place in other fields, such as the physical sciences and within engineering diciplines, some of these more 'brute force' tactics are being replaced with machine learning, opening up an new window of inquiry into practice. The rising influence of machine learning within the broader study of artificial intelligence has allowed many problems to be framed from a completeley different angle.</p> 
            
            <p>Perhaps one of the most tangible contemporary examples of this shift has been seen in the rapid and recent development of self-driving cars. In this context, following more traditional discrete computational tactics would require a designer/programmer to confront the reality of encoding a potentially infinite number of conditional rule sets for the autonomous vehicle's behavior to follow. Instead however, the the complicated rule sets are replaced with rather standard training algorithms that crunch through abundant training data. The training data latently encodes signals that would otherwise need to be hard coded. The objective of the machine learning algorithm is to effectivley learn these signals in the data and produce a predictive models. In this sense, the computers intelegence, or ablitily to make make decisions in a changing environment, resembles more of a probability density function rather than a rule set. And the required inputs for the training of such a model relies on the span of the data, rather than in the completness of any enumerable rule set.</p>

            <p>The power of machine learning is not domain specific however, but rather maluable in it's application. In a sense, any dataset may contain valid signals that can provide the basis for the creation of a predictive model. In the design professions there are many potential application that researchers will strive to uncover over the coming years as this new field takes shape and extends it's reach. The following sub-sections will elaborate on generative design practices, strating with a generalization of what I am calling adaptive-iterative design, or the more traditional practice of generative design. I will then provide a primer in machine learning, and in particular deep learning, from which we can use to understand the basis for what I believe to be the theoretical framework for a generative design process driven by machine learning. This process I am calling conditional-inference design. Here I will expand on some of the core issues that are present in design processes and the human-computer relationships that are required by this new paradigm shift. This framework will serve as the building block to analyze and discuss the various pieces that are required to come together for a ML generative design process. Furthermore, it will also serve loosly as a generalized diagram of the application architecture for terra. The research methods section will touch more precisley on some of the more technical implementation strategies.</p>
        </section>

        <h3>Adaptive-Iterative Design</h3>
        <section>
            <p>To best understand a machine learning driven design process, it is first important to describe the alternative approach to generative design, the adaptive-iterative aproach. The adaptive-iterative approach is the domanant approach and one that incorporates most of the generative design workflows in practice today. Adaptive-iteration is algorithmic in nature and is most generaly centered around a rule set paradigm. However the rule set as an abstract concept can take many forms and can be incorporated into the workflow through a variety of methods. The intention of this section is not to provide an exhaustive list of adaptive-iterative methodologies, but rather to outline the general form that this paradigm takes and to diagram it's core parts.</p>
            
            <img src="img/generative-iterative-design-diagram.svg">
            <figure>Figure 1: Diagram of the adaptive-iterative approach to generative design</figure>
            <br/>

            <p><em>Figure 1</em> depicts a generalized diagram of the adaptive-iterative approach. Here, the design process starts with an idea. This may take many different forms, but in general incorporates some problem statement along with a general strategy for solving that problem. <em>Figure 2</em> is depicting a working example of some of the stages of this diagram. The example is using a generative design process to design and evaluate a programing exercise for a mid-rise building in singapore. This example will be used to demonstrate some of the stages of the diagram. </p>
            
            <p>The idea stage is typically contained in a high-level discription and is not machine interpretable or easily computable. The abstraction process moves data from the idea stage to the rule set stage by encapsulating the high-level problem statement into a set of discritizable rules. For some methods or algorithms such as constraint satifaction as used in <em>Figure 2</em>, the idea is abstracted into formal logical statments that can be computed on. In some situations it is required that the rule set be complete in order for the algorithm to be able to find an valid solution. Other situations or application may allow for incomplete sets, so long as there there is human-computer feedback available to resolve non-haulting problems or infinite loops. Interpretation is the process of moving the rule-set through to the algorithm stage. The rule set schema and algorithm generally are selected in conjunction with one another to ensure compatability. The generation process is the output of the algorithm acting on the rule set leading to and intermediate media stage. The media stage can also take many forms as is determined as part of the process architecture. In design practice, it is common, although not essential, that the media takes on some type of graphics form. <em>Figure 2</em> uses color coded 3d models as a form of media in the iterateration</p>

            <p>The rule set, algorithm, media flow forms a single interation in the process, where the rule set is representing input parameters, and the media representing a solved output. While generative design is often considered to be computation dependant, it is important to remember that in this senario computation is not reuired. In fact it is very possible to do all stages of the iteration via analouge metheds. Computation merely serves as a means for accomodating more complicated rule sets, lengthy alorithms steps, and high fedelity media. Just as long division has be done by pen and paper, so can generative design. Nevertheless is is common to expect significant productivity by using computational methods through iterations. A key stage in moving from a single iteration into an iterative process is the optimizer stage. While a purely mathematical, or engineering based problem may opt for a software based optimizer, it tends to be in the case of design fields that human interation is required or prefered in this stage; although the designer is just conceptualy replacing the machine optimization mechanism. It is here that the designer/optimizer evaluates the media based off of some objective (or subjective) criteria and adjusts either the rule set or the algorithm through iterations; adapting and providing feedback into the system. The example in <em>Figure 2</em> is using objective energy and environmental simulation of the media to accept or reject interations and tune the rule set. This can and often is done through subjective and aesthetic evaluations as well.</p>

            <img src="img/iterative-design.jpg">
            <figure>Figure 2: Example of the adaptive-iterative approach to generative design solving a building programming problem in conceptual design</figure>
            <br/>
            
            <p>The iterative cycle can in some cases become indefinite. It is dificult to say if or when and end-state wil ever be reached. Nevertheless, the intention is for the media to become more fine-tuned to satisfying evaluation criteria, and ultimatley may reach a state of approval or acceptance. Here the fabrication process brings the media into the final state as an artifact. In architecture or landscape architecture this could be the eventual built object or perhaps even a physical or digital model of it.</p>

        </section>

        <h3>A Primer in Deep Learning</h3>
        <section>
            <p>To provide a base understanding of deep learning, a technique part of the broader machine lerning field, this section will outline the core theory. Machine learning represents the field of study concerned with a range of algorithms, techniques, and statistical models known to impove their performance on specific tasks. In this sense, machine learning in its current state forms the model construction of a narrow artificial intelligence. Artificial intelligence is then concerned with not only the modeling of the environment, but the ability to decide, act, and interact with the environment based off of this internal model. Machine learning generally is concerned with creating reliable, accurate, and generalizable models of some phenomena, real or abstract, where the models are used for some specified prediction task. This could be as complex as predicting the outcome of certain events in an autonoumous vehicle example given an extensive aresenal of sensor information, or as straight forward as a linear regression prediction on the number of retweets Donald J Trump's next tweet will recieve given the corpus of all his previous tweets. In all cases the machine learning paradigm follows a similar pattern: (1) there exists some body of data discribing a phenomena of interest, (2) that data contains features (obvious or subtle) that signal the outcome of an event, and (3) the data can be encoded in a manner that exposes these signals. In cases where the features are rather apparent in the data, we can turn to more straight forward ML techniques such as linear and logistic regression. However, in cases where the features are not so obvious, more sophisticated metheds such as deep learning can be used. In deep learning, we are learning not only the relative weights of the features (as in regression) but also learning the features themselves. This ability with deep learning to learn the features along with their respective weights has brought on the recent wave of innovation in machine learning.</p>

            <img src="img/neuron.jpg" style="width:90%">
            <figure>Figure 1: Diagram of the adaptive-iterative approach to generative design</figure>
            <br/>

            <p>TODO</p>
            
            <img src="img/perceptron.svg" style="width:60%">

            <p>TODO</p>

            <table style="width:100%">
                <tr>
                    <td><img src="img/net1.svg"></td>
                    <td><img src="img/net2.svg"></td>
                </tr>
            </table>

            <p>TODO</p>
            <img src="img/CNN.svg">


        </section>

        <h3>Conditional-Inference Design</h3>
        <section>

            <p>TODO</p>
            <img src="img/conditional-inference-design-diagram.svg">
            <p>TODO</p>

            <img src="img/dcgan.jpg">
            <p>TODO</p>

            <img src="img/dcgan2.jpg">
            <p>TODO</p>

            <img src="img/dcgan-results.jpg">
            <p>TODO</p>

        </section>
    </div>

    <!-- PRECEDENT ANALYSIS -->
    <div class="break" id="precedent-analysis">
        <h2>precedent analysis</h2>
        <section>

        </section>

        <!-- DEEP DREAM -->
        <h3>Deep Dream</h3>
        <section>

            <p>TODO</p>

            <!-- Deep Dream Cover Image -->
            <img src="img/deep-dream-cover.jpg">

            <p>TODO</p>

            <!-- Inception v4 Model -->
            <img src="img/inceptionV4.jpg">

            <p>TODO</p>

            <!-- Feature Channel and Hidden Layers -->
            <table style="width:100%">
                <tr>
                    <td><img src="./img/hidden layers/untitled1.png"></td>
                    <td><img src="./img/hidden layers/untitled2.png"></td>
                    <td><img src="./img/hidden layers/untitled3.png"></td>
                    <td><img src="./img/hidden layers/untitled4.png"></td>
                </tr>
                <tr>
                    <td><img src="./img/hidden layers/untitled5.png"></td>
                    <td><img src="./img/hidden layers/untitled6.png"></td>
                    <td><img src="./img/hidden layers/untitled7.png"></td>
                    <td><img src="./img/hidden layers/untitled8.png"></td>
                </tr>
                <tr>
                    <td><img src="./img/hidden layers/untitled9.png"></td>
                    <td><img src="./img/hidden layers/untitled10.png"></td>
                    <td><img src="./img/hidden layers/untitled11.png"></td>
                    <td><img src="./img/hidden layers/untitled12.png"></td>
                </tr>
                <tr>
                    <td><img src="./img/hidden layers/untitled13.png"></td>
                    <td><img src="./img/hidden layers/untitled14.png"></td>
                    <td><img src="./img/hidden layers/untitled15.png"></td>
                    <td><img src="./img/hidden layers/untitled16.png"></td>
                </tr>
            </table>

            <p>TODO</p>

            <!-- Synthetic Images -->
            <table style="width:100%">
                <tr>
                    <td><img src="img/deepdream/deepDream1.jpg"></td>
                    <td><img src="img/deepdream/deepDream2.jpg"></td>
                    <td><img src="img/deepdream/deepDream3.jpg"></td>
                </tr>
                <tr>
                    <td><img src="img/deepdream/deepDream4.jpg"></td>
                    <td><img src="img/deepdream/deepDream5.jpg"></td>
                    <td><img src="img/deepdream/deepDream6.jpg"></td>
                </tr>
            </table>

            <p>TODO</p>

        </section>

        <!-- PIX 2 PIX -->
        <h3>Pix2Pix</h3>
        <section>
            <p>TODO</p>
            <img src="img/image-to-image translation.jpg">
            <p>TODO</p>
            <img src="img/pix2pix1.jpg">
            <p>TODO</p>
            <img src="img/cycleGAN.jpg">
            <p>TODO</p>
        </section>

    </div>

    <!-- RESEARCH METHODS -->
    <div class="break" id="research-methods">
        <h2>research methods</h2>
        <section>
            <p>TODO</p>
        </section>

        <h3>research methods</h3>
        <section>
            <p>TODO</p>
        </section>

        <h3>Generative Adversarial Network Models</h3>
        <section>
            <p>Intro text here to describe the models</p>
            <img src="img/techStack.JPG">
            <!-- Model List -->
            <ul class="model-section">

                <!-- ACGAN -->
                <li class="model-entry">
                    <div class="model-header">
                        <h4 class="model-name">ACGAN</h4>
                        <p class="model-anno">This is a very long description of what the model is doing, copy and
                            paste
                            here</p>
                        <a class="model-display" onclick="displayCode('acgan-code')">code</a>
                        <a class="model-display" onclick="displayCode('acgan-math')">math</a>
                    </div>
                    <div>
                        <!-- Math -->
                        <div class="model-math hidden" id="acgan-math">
                            <p>math here</p>
                        </div>

                        <!-- Code -->
                        <div class="model-code hidden" id="acgan-code">
                            <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- ACGAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">ACGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;ACGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>         <span style="color: #999999; font-style: italic"># dimension of code-vector (label)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># code</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>  <span style="color: #999999; font-style: italic"># categorical distribution (i.e. label)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_continuous_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>  <span style="color: #999999; font-style: italic"># gaussian distribution (e.g. rotation, thickness)</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">classifier</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)5c2s-(128)5c2s_BL-FC1024_BL-FC128_BL-FC12S’</span>
        <span style="color: #999999; font-style: italic"># All layers except the last two layers are shared by discriminator</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;classifier&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(x,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;c_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;c_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;c_fc2&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.softmax(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc4&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit,</span> <span style="color: #d0d0d0">net</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #999999; font-style: italic"># merge noise and code</span>
            <span style="color: #d0d0d0">z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">concat([z,</span> <span style="color: #d0d0d0">y],</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># labels</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;y&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic">## 1. GAN Loss</span>
        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real,</span> <span style="color: #d0d0d0">D_real_logits,</span> <span style="color: #d0d0d0">input4classifier_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake,</span> <span style="color: #d0d0d0">D_fake_logits,</span> <span style="color: #d0d0d0">input4classifier_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_real_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_real)))</span>
        <span style="color: #d0d0d0">d_loss_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.zeros_like(D_fake)))</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d_loss_fake</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_fake)))</span>

        <span style="color: #999999; font-style: italic">## 2. Information Loss</span>
        <span style="color: #d0d0d0">code_fake,</span> <span style="color: #d0d0d0">code_logit_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.classifier(input4classifier_fake,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">code_real,</span> <span style="color: #d0d0d0">code_logit_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.classifier(input4classifier_real,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># For real samples</span>
        <span style="color: #d0d0d0">q_real_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=code_logit_real,</span> <span style="color: #d0d0d0">labels=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y))</span>

        <span style="color: #999999; font-style: italic"># For fake samples</span>
        <span style="color: #d0d0d0">q_fake_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=code_logit_fake,</span> <span style="color: #d0d0d0">labels=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y))</span>

        <span style="color: #999999; font-style: italic"># get information loss</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">q_fake_loss</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">q_real_loss</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">q_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;c_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name)]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss,</span> <span style="color: #d0d0d0">var_list=q_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_real)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_fake)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #d0d0d0">q_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss)</span>
        <span style="color: #d0d0d0">q_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;q_real_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">q_real_loss)</span>
        <span style="color: #d0d0d0">q_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;q_fake_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">q_fake_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([q_loss_sum,</span> <span style="color: #d0d0d0">q_real_sum,</span> <span style="color: #d0d0d0">q_fake_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_codes</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_codes</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[idx</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>

                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                                       <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">batch_codes,</span>
                                                                  <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G &amp; Q network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str_g,</span> <span style="color: #d0d0d0">g_loss,</span> <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str_q,</span> <span style="color: #d0d0d0">q_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span>
                    <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss],</span>
                    <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">batch_codes,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str_g,</span> <span style="color: #d0d0d0">counter)</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str_q,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_codes})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span> <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span>
                        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                        <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random noise, random discrete code, fixed continuous code &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
        <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim*image_frame_dim,:,:,:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; specified condition, random noise &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>  <span style="color: #999999; font-style: italic"># must be less than or equal to self.batch_size</span>

        <span style="color: #d0d0d0">np.random.seed()</span>
        <span style="color: #d0d0d0">si</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">n_styles)</span>

        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">l</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">dtype=np.int64)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">l</span>
            <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
            <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>
            <span style="color: #d0d0d0">save_images(samples[:image_frame_dim*image_frame_dim,:,:,:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                        <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_class_%d.png&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">l)</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples[si,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

            <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">l</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples</span>
            <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((all_samples,</span> <span style="color: #d0d0d0">samples),</span> <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; save merged images to check style-consistency &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">canvas</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros_like(all_samples)</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n_styles):</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">c</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code):</span>
                <span style="color: #d0d0d0">canvas[s</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">c,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">all_samples[c</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

        <span style="color: #d0d0d0">save_images(canvas,</span> <span style="color: #d0d0d0">[n_styles,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes_style_by_style.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                        </div>
                    </div>
                </li>

                <!-- BEGAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">BEGAN</h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('began-code')">code</a>
                            <a class="model-display" onclick="displayCode('began-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="began-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="began-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- BEGAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">BEGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;BEGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># BEGAN Parameter</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.gamma</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.75</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.lamda</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.001</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># It must be Auto-Encoder style architecture</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-FC32_BR-FC64*14*14_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">code</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">32</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc6&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn6&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(code,</span> <span style="color: #3677a9">64</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">14</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_dc5&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #999999; font-style: italic"># recon loss</span>
            <span style="color: #d0d0d0">recon_error</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.sqrt(</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.nn.l2_loss(out</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">x))</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">recon_error,</span> <span style="color: #d0d0d0">code</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; BEGAN variable &quot;&quot;&quot;</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.k</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.Variable(</span><span style="color: #3677a9">0.</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">trainable=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>

        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real_img,</span> <span style="color: #d0d0d0">D_real_err,</span> <span style="color: #d0d0d0">D_real_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake_img,</span> <span style="color: #d0d0d0">D_fake_err,</span> <span style="color: #d0d0d0">D_fake_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">D_real_err</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.k*D_fake_err</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">D_fake_err</span>

        <span style="color: #999999; font-style: italic"># convergence metric</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.M</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">D_real_err</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.abs(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.gamma*D_real_err</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">D_fake_err)</span>

        <span style="color: #999999; font-style: italic"># operation for updating k</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.update_k</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.k.assign(</span>
            <span style="color: #d0d0d0">tf.clip_by_value(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.k</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.lamda*(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.gamma*D_real_err</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">D_fake_err),</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_error_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">D_real_err)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_error_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">D_fake_err)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>
        <span style="color: #d0d0d0">M_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;M&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.M)</span>
        <span style="color: #d0d0d0">k_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;k&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.k)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.p_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([M_sum,</span> <span style="color: #d0d0d0">k_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss],</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update k</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">M_value,</span> <span style="color: #d0d0d0">k_value</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.update_k,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.p_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.M,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.k],</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f, M: %.8f, k: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss,</span> <span style="color: #d0d0d0">M_value,</span> <span style="color: #d0d0d0">k_value))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- CGAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">CGAN </h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('cgan-code')">code</a>
                            <a class="model-display" onclick="displayCode('cgan-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="cgan-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="cgan-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- CGAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">CGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;CGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>         <span style="color: #999999; font-style: italic"># dimension of condition-vector (label)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>


    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #999999; font-style: italic"># merge image and label</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(y,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim])</span>
            <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">conv_cond_concat(x,</span> <span style="color: #d0d0d0">y)</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc4&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit,</span> <span style="color: #d0d0d0">net</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #999999; font-style: italic"># merge noise and label</span>
            <span style="color: #d0d0d0">z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">concat([z,</span> <span style="color: #d0d0d0">y],</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># labels</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;y&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>

        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real,</span> <span style="color: #d0d0d0">D_real_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake,</span> <span style="color: #d0d0d0">D_fake_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_real_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_real)))</span>
        <span style="color: #d0d0d0">d_loss_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.zeros_like(D_fake)))</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d_loss_fake</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_fake)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_real)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_fake)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[idx</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                                       <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">batch_labels,</span>
                                                                  <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss],</span>
                                                       <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">batch_labels,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_labels})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
        <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; specified condition, random noise &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>  <span style="color: #999999; font-style: italic"># must be less than or equal to self.batch_size</span>

        <span style="color: #d0d0d0">np.random.seed()</span>
        <span style="color: #d0d0d0">si</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">n_styles)</span>

        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">l</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">dtype=np.int64)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">l</span>
            <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
            <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>
            <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                        <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_class_%d.png&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">l)</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples[si,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

            <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">l</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples</span>
            <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((all_samples,</span> <span style="color: #d0d0d0">samples),</span> <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; save merged images to check style-consistency &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">canvas</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros_like(all_samples)</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n_styles):</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">c</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim):</span>
                <span style="color: #d0d0d0">canvas[s</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">c,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">all_samples[c</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

        <span style="color: #d0d0d0">save_images(canvas,</span> <span style="color: #d0d0d0">[n_styles,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes_style_by_style.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- CVAE -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">CVAE </h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('cvae-code')">code</a>
                            <a class="model-display" onclick="displayCode('cvae-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="cvae-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="cvae-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- CVAE -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">prior_factory</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">prior</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">CVAE</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;CVAE&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>         <span style="color: #999999; font-style: italic"># dimension of condition-vector (label)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #999999; font-style: italic"># Gaussian Encoder</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">encoder</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;encoder&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #999999; font-style: italic"># merge image and label</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(y,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim])</span>
            <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">conv_cond_concat(x,</span> <span style="color: #d0d0d0">y)</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;en_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;en_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">gaussian_params</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">2</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_fc4&#39;</span><span style="color: #d0d0d0">)</span>

            <span style="color: #999999; font-style: italic"># The mean parameter is unconstrained</span>
            <span style="color: #d0d0d0">mean</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">gaussian_params[:,</span> <span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]</span>
            <span style="color: #999999; font-style: italic"># The standard deviation must be positive. Parametrize with a softplus and</span>
            <span style="color: #999999; font-style: italic"># add a small epsilon for numerical stability</span>
            <span style="color: #d0d0d0">stddev</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1e-6</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.nn.softplus(gaussian_params[:,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim:])</span>

        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">mean,</span> <span style="color: #d0d0d0">stddev</span>

    <span style="color: #999999; font-style: italic"># Bernoulli decoder</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">decoder</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;decoder&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #999999; font-style: italic"># merge noise and label</span>
            <span style="color: #d0d0d0">z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">concat([z,</span> <span style="color: #d0d0d0">y],</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;de_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;de_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># labels</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;y&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># encoding</span>
        <span style="color: #d0d0d0">mu,</span> <span style="color: #d0d0d0">sigma</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.encoder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span>  <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># sampling by re-parameterization technique</span>
        <span style="color: #d0d0d0">z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">mu</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">sigma</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.random_normal(tf.shape(mu),</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">dtype=tf.float32)</span>

        <span style="color: #999999; font-style: italic"># decoding</span>
        <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.decoder(z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.clip_by_value(out,</span> <span style="color: #3677a9">1e-8</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1e-8</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loss</span>
        <span style="color: #d0d0d0">marginal_likelihood</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_sum(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.log(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.out)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs)</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.log(</span><span style="color: #3677a9">1</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.out),</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">])</span>
        <span style="color: #d0d0d0">KL_divergence</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.reduce_sum(tf.square(mu)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.square(sigma)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">tf.log(</span><span style="color: #3677a9">1e-8</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.square(sigma))</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-tf.reduce_mean(marginal_likelihood)</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(KL_divergence)</span>

        <span style="color: #d0d0d0">ELBO</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-ELBO</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss,</span> <span style="color: #d0d0d0">var_list=t_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.decoder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">nll_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;nll&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood)</span>
        <span style="color: #d0d0d0">kl_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;kl&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence)</span>
        <span style="color: #d0d0d0">loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.merged_summary_op</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge_all()</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">prior.gaussian(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[idx</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update autoencoder</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">loss,</span> <span style="color: #d0d0d0">nll_loss,</span> <span style="color: #d0d0d0">kl_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.merged_summary_op,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">batch_labels,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, loss: %.8f, nll: %.8f, kl: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">loss,</span> <span style="color: #d0d0d0">nll_loss,</span> <span style="color: #d0d0d0">kl_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_labels})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
        <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">prior.gaussian(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; specified condition, random noise &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>  <span style="color: #999999; font-style: italic"># must be less than or equal to self.batch_size</span>

        <span style="color: #d0d0d0">np.random.seed()</span>
        <span style="color: #d0d0d0">si</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">n_styles)</span>

        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">l</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">dtype=np.int64)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">l</span>
            <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
            <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>
            <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                        <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_class_%d.png&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">l)</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples[si,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

            <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">l</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples</span>
            <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((all_samples,</span> <span style="color: #d0d0d0">samples),</span> <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; save merged images to check style-consistency &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">canvas</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros_like(all_samples)</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n_styles):</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">c</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim):</span>
                <span style="color: #d0d0d0">canvas[s</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">c,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">all_samples[c</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

        <span style="color: #d0d0d0">save_images(canvas,</span> <span style="color: #d0d0d0">[n_styles,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes_style_by_style.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- DRAGAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">DRAGAN</h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('dragan-code')">code</a>
                            <a class="model-display" onclick="displayCode('dragan-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="dragan-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="dragan-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- DRAGAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">DRAGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;DRAGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># DRAGAN parameter</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.lambd</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.25</span>       <span style="color: #999999; font-style: italic"># The higher value, the more stable, but the slower convergence</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc4&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit,</span> <span style="color: #d0d0d0">net</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">get_perturbed_batch</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">minibatch):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">minibatch</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">0.5</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">minibatch.std()</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">np.random.random(minibatch.shape)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs_p</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_perturbed_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>

        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real,</span> <span style="color: #d0d0d0">D_real_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake,</span> <span style="color: #d0d0d0">D_fake_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_real_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_real)))</span>
        <span style="color: #d0d0d0">d_loss_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.zeros_like(D_fake)))</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d_loss_fake</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_fake)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; DRAGAN Loss (Gradient penalty) &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># This is borrowed from https://github.com/kodalinaveen3/DRAGAN/blob/master/DRAGAN.ipynb</span>
        <span style="color: #d0d0d0">alpha</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.random_uniform(shape=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs.get_shape(),</span> <span style="color: #d0d0d0">minval=</span><span style="color: #3677a9">0.</span><span style="color: #d0d0d0">,maxval=</span><span style="color: #3677a9">1.</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">differences</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs_p</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span>  <span style="color: #999999; font-style: italic"># This is different from WGAN-GP</span>
        <span style="color: #d0d0d0">interpolates</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">(alpha</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">differences)</span>
        <span style="color: #d0d0d0">_,D_inter,_=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(interpolates,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">gradients</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.gradients(D_inter,</span> <span style="color: #d0d0d0">[interpolates])[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
        <span style="color: #d0d0d0">slopes</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.sqrt(tf.reduce_sum(tf.square(gradients),</span> <span style="color: #d0d0d0">reduction_indices=[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]))</span>
        <span style="color: #d0d0d0">gradient_penalty</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean((slopes</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1.</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">**</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">+=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.lambd</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">gradient_penalty</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_real)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_fake)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_images_p</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.get_perturbed_batch(batch_images)</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs_p:</span> <span style="color: #d0d0d0">batch_images_p,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss],</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- EBGAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">EBGAN</h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('ebgan-code')">code</a>
                            <a class="model-display" onclick="displayCode('ebgan-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="ebgan-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="ebgan-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- EBGAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">EBGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;EBGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># EBGAN Parameter</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.pt_loss_weight</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.1</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.margin</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">max</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size/</span><span style="color: #3677a9">64.</span><span style="color: #d0d0d0">)</span>        <span style="color: #999999; font-style: italic"># margin for loss function</span>
            <span style="color: #999999; font-style: italic"># usually margin of 1 is enough, but for large batch size it must be larger than 1</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #999999; font-style: italic"># borrowed from https://github.com/shekkizh/EBGAN.tensorflow/blob/master/EBGAN/Faces_EBGAN.py</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">pullaway_loss</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">embeddings):</span>
        <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">        Pull Away loss calculation</span>
<span style="color: #ed9d13">        :param embeddings: The embeddings to be orthogonalized for varied faces. Shape [batch_size, embeddings_dim]</span>
<span style="color: #ed9d13">        :return: pull away term loss</span>
<span style="color: #ed9d13">        &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">norm</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.sqrt(tf.reduce_sum(tf.square(embeddings),</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">keep_dims=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">))</span>
        <span style="color: #d0d0d0">normalized_embeddings</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">embeddings</span> <span style="color: #d0d0d0">/</span> <span style="color: #d0d0d0">norm</span>
        <span style="color: #d0d0d0">similarity</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.matmul(</span>
            <span style="color: #d0d0d0">normalized_embeddings,</span> <span style="color: #d0d0d0">normalized_embeddings,</span> <span style="color: #d0d0d0">transpose_b=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.cast(tf.shape(embeddings)[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">tf.float32)</span>
        <span style="color: #d0d0d0">pt_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(tf.reduce_sum(similarity)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">batch_size)</span> <span style="color: #d0d0d0">/</span> <span style="color: #d0d0d0">(batch_size</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">(batch_size</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">))</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">pt_loss</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># It must be Auto-Encoder style architecture</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-FC32-FC64*14*14_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">code</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(linear(net,</span> <span style="color: #3677a9">32</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc6&#39;</span><span style="color: #d0d0d0">))</span> <span style="color: #999999; font-style: italic"># bn and relu are excluded since code is used in pullaway_loss</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(code,</span> <span style="color: #3677a9">64</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">14</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_dc5&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #999999; font-style: italic"># recon loss</span>
            <span style="color: #d0d0d0">recon_error</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.sqrt(</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.nn.l2_loss(out</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">x))</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">recon_error,</span> <span style="color: #d0d0d0">code</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>

        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real_img,</span> <span style="color: #d0d0d0">D_real_err,</span> <span style="color: #d0d0d0">D_real_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake_img,</span> <span style="color: #d0d0d0">D_fake_err,</span> <span style="color: #d0d0d0">D_fake_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">D_real_err</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.maximum(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.margin</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">D_fake_err,</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">D_fake_err</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.pt_loss_weight*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.pullaway_loss(D_fake_code)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_error_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">D_real_err)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_error_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">D_fake_err)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss],</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- GAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">GAN  </h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('gan-code')">code</a>
                            <a class="model-display" onclick="displayCode('gan-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="gan-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="gan-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- GAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">GAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;GAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc4&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit,</span> <span style="color: #d0d0d0">net</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>

        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real,</span> <span style="color: #d0d0d0">D_real_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake,</span> <span style="color: #d0d0d0">D_fake_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_real_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_real)))</span>
        <span style="color: #d0d0d0">d_loss_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.zeros_like(D_fake)))</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d_loss_fake</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_fake)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_real)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_fake)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss],</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- LSGAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">LSGAN</h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('lsgan-code')">code</a>
                            <a class="model-display" onclick="displayCode('lsgan-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="lsgan-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="lsgan-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- LSGAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">LSGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;LSGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc4&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit,</span> <span style="color: #d0d0d0">net</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">mse_loss</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">pred,</span> <span style="color: #d0d0d0">data):</span>
        <span style="color: #d0d0d0">loss_val</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.sqrt(</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.nn.l2_loss(pred</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">data))</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">loss_val</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>

        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real,</span> <span style="color: #d0d0d0">D_real_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake,</span> <span style="color: #d0d0d0">D_fake_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.mse_loss(D_real_logits,</span> <span style="color: #d0d0d0">tf.ones_like(D_real_logits)))</span>
        <span style="color: #d0d0d0">d_loss_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.mse_loss(D_fake_logits,</span> <span style="color: #d0d0d0">tf.zeros_like(D_fake_logits)))</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span><span style="color: #d0d0d0">*(d_loss_real</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d_loss_fake)</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.mse_loss(D_fake_logits,</span> <span style="color: #d0d0d0">tf.ones_like(D_fake_logits)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>

        <span style="color: #999999; font-style: italic"># weight clipping</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.clip_D</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[p.assign(tf.clip_by_value(p,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">0.01</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0.01</span><span style="color: #d0d0d0">))</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">p</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">d_vars]</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_real)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_fake)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.clip_D,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss],</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- VAE -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">VAE</h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('vae-code')">code</a>
                            <a class="model-display" onclick="displayCode('vae-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="vae-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="vae-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- VAE -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">prior_factory</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">prior</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">VAE</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;VAE&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #999999; font-style: italic"># Gaussian Encoder</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">encoder</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC62*4</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;encoder&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;en_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;en_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">gaussian_params</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">2</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;en_fc4&#39;</span><span style="color: #d0d0d0">)</span>

            <span style="color: #999999; font-style: italic"># The mean parameter is unconstrained</span>
            <span style="color: #d0d0d0">mean</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">gaussian_params[:,</span> <span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]</span>
            <span style="color: #999999; font-style: italic"># The standard deviation must be positive. Parametrize with a softplus and</span>
            <span style="color: #999999; font-style: italic"># add a small epsilon for numerical stability</span>
            <span style="color: #d0d0d0">stddev</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1e-6</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.nn.softplus(gaussian_params[:,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim:])</span>

        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">mean,</span> <span style="color: #d0d0d0">stddev</span>

    <span style="color: #999999; font-style: italic"># Bernoulli decoder</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">decoder</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;decoder&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;de_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;de_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;de_dc4&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># encoding</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.mu,</span> <span style="color: #d0d0d0">sigma</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.encoder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>        

        <span style="color: #999999; font-style: italic"># sampling by re-parameterization technique</span>
        <span style="color: #d0d0d0">z</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.mu</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">sigma</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.random_normal(tf.shape(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.mu),</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">dtype=tf.float32)</span>

        <span style="color: #999999; font-style: italic"># decoding</span>
        <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.decoder(z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.clip_by_value(out,</span> <span style="color: #3677a9">1e-8</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1e-8</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loss</span>
        <span style="color: #d0d0d0">marginal_likelihood</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_sum(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.log(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.out)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs)</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.log(</span><span style="color: #3677a9">1</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.out),</span>
                                            <span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">])</span>
        <span style="color: #d0d0d0">KL_divergence</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">tf.reduce_sum(tf.square(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.mu)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.square(sigma)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">tf.log(</span><span style="color: #3677a9">1e-8</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">tf.square(sigma))</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-tf.reduce_mean(marginal_likelihood)</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(KL_divergence)</span>

        <span style="color: #d0d0d0">ELBO</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-ELBO</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss,</span> <span style="color: #d0d0d0">var_list=t_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.decoder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">nll_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;nll&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood)</span>
        <span style="color: #d0d0d0">kl_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;kl&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence)</span>
        <span style="color: #d0d0d0">loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.merged_summary_op</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge_all()</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">prior.gaussian(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">prior.gaussian(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

                <span style="color: #999999; font-style: italic"># update autoencoder</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">loss,</span> <span style="color: #d0d0d0">nll_loss,</span> <span style="color: #d0d0d0">kl_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.merged_summary_op,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.loss,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.neg_loglikelihood,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.KL_divergence],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, loss: %.8f, nll: %.8f, kl: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">loss,</span> <span style="color: #d0d0d0">nll_loss,</span> <span style="color: #d0d0d0">kl_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z})</span>

                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">prior.gaussian(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span>
                        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; learned manifold &quot;&quot;&quot;</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">2</span>

            <span style="color: #d0d0d0">z_tot</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">None</span>
            <span style="color: #d0d0d0">id_tot</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">None</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">100</span><span style="color: #d0d0d0">):</span>
                <span style="color: #999999; font-style: italic">#randomly sampling</span>
                <span style="color: #24909d">id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.randint(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[</span><span style="color: #24909d">id</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(</span><span style="color: #24909d">id</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[</span><span style="color: #24909d">id</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(</span><span style="color: #24909d">id</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>

                <span style="color: #d0d0d0">z</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.mu,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images})</span>

                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">idx</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">z_tot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z</span>
                    <span style="color: #d0d0d0">id_tot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_labels</span>
                <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">z_tot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((z_tot,</span> <span style="color: #d0d0d0">z),</span> <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>
                    <span style="color: #d0d0d0">id_tot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((id_tot,</span> <span style="color: #d0d0d0">batch_labels),</span> <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>

            <span style="color: #d0d0d0">save_scattered_image(z_tot,</span> <span style="color: #d0d0d0">id_tot,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=check_folder(</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_learned_manifold.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- WGAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">WGAN</h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('wgan-code')">code</a>
                            <a class="model-display" onclick="displayCode('wgan-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="wgan-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="wgan-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- WGAN -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">WGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;WGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #999999; font-style: italic"># WGAN parameter</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.disc_iters</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>     <span style="color: #999999; font-style: italic"># The number of critic iterations for one-step of generator</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc4&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit,</span> <span style="color: #d0d0d0">net</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>

        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real,</span> <span style="color: #d0d0d0">D_real_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake,</span> <span style="color: #d0d0d0">D_fake_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">tf.reduce_mean(D_real_logits)</span>
        <span style="color: #d0d0d0">d_loss_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(D_fake_logits)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d_loss_fake</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">d_loss_fake</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                      <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>

        <span style="color: #999999; font-style: italic"># weight clipping</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.clip_D</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[p.assign(tf.clip_by_value(p,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">0.01</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0.01</span><span style="color: #d0d0d0">))</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">p</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">d_vars]</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_real)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_fake)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.clip_D,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                               <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G network</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">%</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.disc_iters</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss],</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                    <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random condition, random noise &quot;&quot;&quot;</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

                <!-- infoGAN -->
                <li class="model-entry">
                        <div class="model-header">
                            <h4 class="model-name">infoGAN</h4>
                            <p class="model-anno">This is a very long description of what the model is doing, copy and
                                paste
                                here</p>
                            <a class="model-display" onclick="displayCode('infogan-code')">code</a>
                            <a class="model-display" onclick="displayCode('infogan-math')">math</a>
                        </div>
                        <div>
                            <!-- Math -->
                            <div class="model-math hidden" id="infogan-math">
                                <p>math here</p>
                            </div>
    
                            <!-- Code -->
                            <div class="model-code hidden" id="infogan-code">
                                <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #999999; font-style: italic">#-*- coding: utf-8 -*-</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">__future__</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">division</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">os</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">tensorflow</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">tf</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ops</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">utils</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">infoGAN</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">object</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">model_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;infoGAN&quot;</span>     <span style="color: #999999; font-style: italic"># name for checkpoint</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">sess,</span> <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">batch_size,</span> <span style="color: #d0d0d0">z_dim,</span> <span style="color: #d0d0d0">dataset_name,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">result_dir,</span> <span style="color: #d0d0d0">log_dir,</span> <span style="color: #d0d0d0">SUPERVISED=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sess</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dataset_name</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">result_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">log_dir</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">epoch</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">batch_size</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;mnist&#39;</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">dataset_name</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;fashion-mnist&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #999999; font-style: italic"># parameters</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.output_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">28</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">z_dim</span>         <span style="color: #999999; font-style: italic"># dimension of noise-vector</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">12</span>         <span style="color: #999999; font-style: italic"># dimension of code-vector (label+two features)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.SUPERVISED</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">SUPERVISED</span> <span style="color: #999999; font-style: italic"># if it is true, label info is directly used for code</span>

            <span style="color: #999999; font-style: italic"># train</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.0002</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.5</span>

            <span style="color: #999999; font-style: italic"># test</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">64</span>  <span style="color: #999999; font-style: italic"># number of generated images to be saved</span>

            <span style="color: #999999; font-style: italic"># code</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>  <span style="color: #999999; font-style: italic"># categorical distribution (i.e. label)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_continuous_code</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>  <span style="color: #999999; font-style: italic"># gaussian distribution (e.g. rotation, thickness)</span>

            <span style="color: #999999; font-style: italic"># load mnist</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">load_mnist(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name)</span>

            <span style="color: #999999; font-style: italic"># get number of batches for a single epoch</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X)</span> <span style="color: #d0d0d0">//</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">classifier</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)5c2s-(128)5c2s_BL-FC1024_BL-FC128_BL-FC12S’</span>
        <span style="color: #999999; font-style: italic"># All layers except the last two layers are shared by discriminator</span>
        <span style="color: #999999; font-style: italic"># Number of nodes in the last layer is reduced by half. It gives better results.</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;classifier&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;c_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;c_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;c_fc2&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.softmax(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">discriminator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : (64)4c2s-(128)4c2s_BL-FC1024_BL-FC1_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;discriminator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(conv2d(x,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(conv2d(net,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;d_conv2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lrelu(bn(linear(net,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_bn3&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">out_logit</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linear(net,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;d_fc4&#39;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(out_logit)</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out,</span> <span style="color: #d0d0d0">out_logit,</span> <span style="color: #d0d0d0">net</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">generator</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">z,</span> <span style="color: #d0d0d0">y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># Network Architecture is exactly same as in infoGAN (https://arxiv.org/abs/1606.03657)</span>
        <span style="color: #999999; font-style: italic"># Architecture : FC1024_BR-FC7x7x128_BR-(64)4dc2s_BR-(1)4dc2s_S</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.variable_scope(</span><span style="color: #ed9d13">&quot;generator&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=reuse):</span>

            <span style="color: #999999; font-style: italic"># merge noise and code</span>
            <span style="color: #d0d0d0">z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">concat([z,</span> <span style="color: #d0d0d0">y],</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(z,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc1&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn1&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(bn(linear(net,</span> <span style="color: #3677a9">128</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_fc2&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span> <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn2&#39;</span><span style="color: #d0d0d0">))</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reshape(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">7</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">128</span><span style="color: #d0d0d0">])</span>
            <span style="color: #d0d0d0">net</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.relu(</span>
                <span style="color: #d0d0d0">bn(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">14</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">64</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc3&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">is_training=is_training,</span>
                   <span style="color: #d0d0d0">scope=</span><span style="color: #ed9d13">&#39;g_bn3&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #d0d0d0">out</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.nn.sigmoid(deconv2d(net,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">28</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;g_dc4&#39;</span><span style="color: #d0d0d0">))</span>

            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">out</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">build_model</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #999999; font-style: italic"># some parameters</span>
        <span style="color: #d0d0d0">image_dims</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_height,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.input_width,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c_dim]</span>
        <span style="color: #d0d0d0">bs</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Graph Input &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># images</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">image_dims,</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;real_images&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># labels</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;y&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># noises</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.placeholder(tf.float32,</span> <span style="color: #d0d0d0">[bs,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim],</span> <span style="color: #d0d0d0">name=</span><span style="color: #ed9d13">&#39;z&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Loss Function &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic">## 1. GAN Loss</span>
        <span style="color: #999999; font-style: italic"># output of D for real images</span>
        <span style="color: #d0d0d0">D_real,</span> <span style="color: #d0d0d0">D_real_logits,</span> <span style="color: #d0d0d0">_</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># output of D for fake images</span>
        <span style="color: #d0d0d0">G</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">D_fake,</span> <span style="color: #d0d0d0">D_fake_logits,</span> <span style="color: #d0d0d0">input4classifier_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.discriminator(G,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># get loss for discriminator</span>
        <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_real_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_real)))</span>
        <span style="color: #d0d0d0">d_loss_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.zeros_like(D_fake)))</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d_loss_real</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d_loss_fake</span>

        <span style="color: #999999; font-style: italic"># get loss for generator</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(</span>
            <span style="color: #d0d0d0">tf.nn.sigmoid_cross_entropy_with_logits(logits=D_fake_logits,</span> <span style="color: #d0d0d0">labels=tf.ones_like(D_fake)))</span>

        <span style="color: #999999; font-style: italic">## 2. Information Loss</span>
        <span style="color: #d0d0d0">code_fake,</span> <span style="color: #d0d0d0">code_logit_fake</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.classifier(input4classifier_fake,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># discrete code : categorical</span>
        <span style="color: #d0d0d0">disc_code_est</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">code_logit_fake[:,</span> <span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code]</span>
        <span style="color: #d0d0d0">disc_code_tg</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y[:,</span> <span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code]</span>
        <span style="color: #d0d0d0">q_disc_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=disc_code_est,</span> <span style="color: #d0d0d0">labels=disc_code_tg))</span>

        <span style="color: #999999; font-style: italic"># continuous code : gaussian</span>
        <span style="color: #d0d0d0">cont_code_est</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">code_logit_fake[:,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code:]</span>
        <span style="color: #d0d0d0">cont_code_tg</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y[:,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code:]</span>
        <span style="color: #d0d0d0">q_cont_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.reduce_mean(tf.reduce_sum(tf.square(cont_code_tg</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">cont_code_est),</span> <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">))</span>

        <span style="color: #999999; font-style: italic"># get information loss</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">q_disc_loss</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">q_cont_loss</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Training &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># divide trainable variables into a group for D and a group for G</span>
        <span style="color: #d0d0d0">t_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.trainable_variables()</span>
        <span style="color: #d0d0d0">d_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">g_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name]</span>
        <span style="color: #d0d0d0">q_vars</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[var</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">var</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">t_vars</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;d_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;c_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;g_&#39;</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">var.name)]</span>

        <span style="color: #999999; font-style: italic"># optimizers</span>
        <span style="color: #6ab825; font-weight: bold">with</span> <span style="color: #d0d0d0">tf.control_dependencies(tf.get_collection(tf.GraphKeys.UPDATE_OPS)):</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss,</span> <span style="color: #d0d0d0">var_list=d_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #d0d0d0">var_list=g_vars)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_optim</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.AdamOptimizer(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.learning_rate</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">beta1=</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.beta1)</span> \
                <span style="color: #d0d0d0">.minimize(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss,</span> <span style="color: #d0d0d0">var_list=q_vars)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot;&quot; Testing &quot;&quot;&quot;</span>
        <span style="color: #999999; font-style: italic"># for test</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.generator(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y,</span> <span style="color: #d0d0d0">is_training=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">reuse=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; Summary &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">d_loss_real_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_real&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_real)</span>
        <span style="color: #d0d0d0">d_loss_fake_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss_fake&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">d_loss_fake)</span>
        <span style="color: #d0d0d0">d_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;d_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss)</span>
        <span style="color: #d0d0d0">g_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss)</span>

        <span style="color: #d0d0d0">q_loss_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;g_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss)</span>
        <span style="color: #d0d0d0">q_disc_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;q_disc_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">q_disc_loss)</span>
        <span style="color: #d0d0d0">q_cont_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.scalar(</span><span style="color: #ed9d13">&quot;q_cont_loss&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">q_cont_loss)</span>

        <span style="color: #999999; font-style: italic"># final summary operations</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_fake_sum,</span> <span style="color: #d0d0d0">g_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([d_loss_real_sum,</span> <span style="color: #d0d0d0">d_loss_sum])</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_sum</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.merge([q_loss_sum,</span> <span style="color: #d0d0d0">q_disc_sum,</span> <span style="color: #d0d0d0">q_cont_sum])</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">train</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>

        <span style="color: #999999; font-style: italic"># initialize all variables</span>
        <span style="color: #d0d0d0">tf.global_variables_initializer().run()</span>

        <span style="color: #999999; font-style: italic"># graph inputs for visualize training results</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size</span> <span style="color: #d0d0d0">,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_codes</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_labels,</span> <span style="color: #d0d0d0">np.zeros([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_continuous_code])),</span>
                                           <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># saver to save model</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.Saver()</span>

        <span style="color: #999999; font-style: italic"># summary writer</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.summary.FileWriter(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.log_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.graph)</span>

        <span style="color: #999999; font-style: italic"># restore check-point if it exits</span>
        <span style="color: #d0d0d0">could_load,</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.load(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">could_load:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">)(checkpoint_counter</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches)</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">checkpoint_counter</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Load SUCCESS&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">start_epoch</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [!] Load failed...&quot;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #999999; font-style: italic"># loop for epoch</span>
        <span style="color: #d0d0d0">start_time</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">time.time()</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_epoch,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.epoch):</span>

            <span style="color: #999999; font-style: italic"># get batch data</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">idx</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(start_batch_id,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches):</span>
                <span style="color: #d0d0d0">batch_images</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_X[idx*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>

                <span style="color: #999999; font-style: italic"># generate code</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.SUPERVISED</span> <span style="color: #d0d0d0">==</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">batch_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.data_y[idx</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size:(idx</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size]</span>
                <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">batch_labels</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.multinomial(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span>
                                                         <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">/</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code)],</span>
                                                         <span style="color: #d0d0d0">size=[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size])</span>

                <span style="color: #d0d0d0">batch_codes</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((batch_labels,</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">))),</span>
                                             <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

                <span style="color: #d0d0d0">batch_z</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim]).astype(np.float32)</span>

                <span style="color: #999999; font-style: italic"># update D network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str,</span> <span style="color: #d0d0d0">d_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.d_loss],</span>
                                                       <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">batch_codes,</span>
                                                                  <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># update G and Q network</span>
                <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str_g,</span> <span style="color: #d0d0d0">g_loss,</span> <span style="color: #d0d0d0">_,</span> <span style="color: #d0d0d0">summary_str_q,</span> <span style="color: #d0d0d0">q_loss</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span>
                    <span style="color: #d0d0d0">[</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.g_loss,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_optim,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_sum,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.q_loss],</span>
                    <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.inputs:</span> <span style="color: #d0d0d0">batch_images,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">batch_z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">batch_codes})</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str_g,</span> <span style="color: #d0d0d0">counter)</span>
                <span style="color: #24909d">self</span><span style="color: #d0d0d0">.writer.add_summary(summary_str_q,</span> <span style="color: #d0d0d0">counter)</span>

                <span style="color: #999999; font-style: italic"># display training status</span>
                <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
                <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;Epoch: [%2d] [%4d/%4d] time: %4.4f, d_loss: %.8f, g_loss: %.8f&quot;</span> \
                      <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(epoch,</span> <span style="color: #d0d0d0">idx,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.num_batches,</span> <span style="color: #d0d0d0">time.time()</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">start_time,</span> <span style="color: #d0d0d0">d_loss,</span> <span style="color: #d0d0d0">g_loss))</span>

                <span style="color: #999999; font-style: italic"># save training results for every 300 steps</span>
                <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">np.mod(counter,</span> <span style="color: #3677a9">300</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                    <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                            <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_z,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.test_codes})</span>
                    <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
                    <span style="color: #d0d0d0">manifold_h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">manifold_w</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>
                    <span style="color: #d0d0d0">save_images(samples[:manifold_h</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">manifold_w,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[manifold_h,</span> <span style="color: #d0d0d0">manifold_w],</span>
                                <span style="color: #ed9d13">&#39;./&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_train_{:02d}_{:04d}.png&#39;</span><span style="color: #d0d0d0">.format(</span>
                                    <span style="color: #d0d0d0">epoch,</span> <span style="color: #d0d0d0">idx))</span>

            <span style="color: #999999; font-style: italic"># After an epoch, start_batch_id is set to zero</span>
            <span style="color: #999999; font-style: italic"># non-zero value is only for the first epoch after loading pre-trained model</span>
            <span style="color: #d0d0d0">start_batch_id</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>

            <span style="color: #999999; font-style: italic"># save model</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

            <span style="color: #999999; font-style: italic"># show temporal results</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.visualize_results(epoch)</span>

        <span style="color: #999999; font-style: italic"># save model for final step</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.checkpoint_dir,</span> <span style="color: #d0d0d0">counter)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_results</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">epoch):</span>
        <span style="color: #d0d0d0">tot_num_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">min</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sample_num,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">image_frame_dim</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(np.floor(np.sqrt(tot_num_samples)))</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; random noise, random discrete code, fixed continuous code &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size)</span>
        <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
        <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

        <span style="color: #d0d0d0">z_sample</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.uniform(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">size=(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim))</span>

        <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>

        <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes.png&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; specified condition, random noise &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span>  <span style="color: #999999; font-style: italic"># must be less than or equal to self.batch_size</span>

        <span style="color: #d0d0d0">np.random.seed()</span>
        <span style="color: #d0d0d0">si</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.random.choice(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">n_styles)</span>

        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">l</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">dtype=np.int64)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">l</span>
            <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
            <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span> <span style="color: #d0d0d0">feed_dict={</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_sample,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>
            <span style="color: #999999; font-style: italic"># save_images(samples[:image_frame_dim * image_frame_dim, :, :, :], [image_frame_dim, image_frame_dim],</span>
            <span style="color: #999999; font-style: italic">#             check_folder(self.result_dir + &#39;/&#39; + self.model_dir) + &#39;/&#39; + self.model_name + &#39;_epoch%03d&#39; % epoch + &#39;_test_class_%d.png&#39; % l)</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples[si,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

            <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">l</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">samples</span>
            <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">all_samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.concatenate((all_samples,</span> <span style="color: #d0d0d0">samples),</span> <span style="color: #d0d0d0">axis=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; save merged images to check style-consistency &quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">canvas</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros_like(all_samples)</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n_styles):</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">c</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code):</span>
                <span style="color: #d0d0d0">canvas[s</span> <span style="color: #d0d0d0">*</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">c,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">all_samples[c</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">n_styles</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:]</span>

        <span style="color: #d0d0d0">save_images(canvas,</span> <span style="color: #d0d0d0">[n_styles,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code],</span>
                    <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_all_classes_style_by_style.png&#39;</span><span style="color: #d0d0d0">)</span>

        <span style="color: #ed9d13">&quot;&quot;&quot; fixed noise &quot;&quot;&quot;</span>
        <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_continuous_code</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">2</span>

        <span style="color: #d0d0d0">c1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.linspace(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">image_frame_dim)</span>
        <span style="color: #d0d0d0">c2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.linspace(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">image_frame_dim)</span>
        <span style="color: #d0d0d0">xv,</span> <span style="color: #d0d0d0">yv</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.meshgrid(c1,</span> <span style="color: #d0d0d0">c2)</span>
        <span style="color: #d0d0d0">xv</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">xv[:image_frame_dim,:image_frame_dim]</span>
        <span style="color: #d0d0d0">yv</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">yv[:image_frame_dim,</span> <span style="color: #d0d0d0">:image_frame_dim]</span>

        <span style="color: #d0d0d0">c1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">xv.flatten()</span>
        <span style="color: #d0d0d0">c2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">yv.flatten()</span>

        <span style="color: #d0d0d0">z_fixed</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros([</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim])</span>

        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">l</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #d0d0d0">dtype=np.int64)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">l</span>
            <span style="color: #d0d0d0">y_one_hot</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros((</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y_dim))</span>
            <span style="color: #d0d0d0">y_one_hot[np.arange(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size),</span> <span style="color: #d0d0d0">y]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>

            <span style="color: #d0d0d0">y_one_hot[np.arange(image_frame_dim*image_frame_dim),</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">c1</span>
            <span style="color: #d0d0d0">y_one_hot[np.arange(image_frame_dim*image_frame_dim),</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.len_discrete_code+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">c2</span>

            <span style="color: #d0d0d0">samples</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess.run(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.fake_images,</span>
                                    <span style="color: #d0d0d0">feed_dict={</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z:</span> <span style="color: #d0d0d0">z_fixed,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.y:</span> <span style="color: #d0d0d0">y_one_hot})</span>

            <span style="color: #d0d0d0">save_images(samples[:image_frame_dim</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">image_frame_dim,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:,</span> <span style="color: #d0d0d0">:],</span> <span style="color: #d0d0d0">[image_frame_dim,</span> <span style="color: #d0d0d0">image_frame_dim],</span>
                        <span style="color: #d0d0d0">check_folder(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.result_dir</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir)</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;/&#39;</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_epoch%03d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">epoch</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;_test_class_c1c2_%d.png&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">l)</span>

    <span style="color: #ffa500">@property</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">model_dir</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;{}_{}_{}_{}&quot;</span><span style="color: #d0d0d0">.format(</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.dataset_name,</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.batch_size,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.z_dim)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">save</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir,</span> <span style="color: #d0d0d0">step):</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.exists(checkpoint_dir):</span>
            <span style="color: #d0d0d0">os.makedirs(checkpoint_dir)</span>

        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.save(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name+</span><span style="color: #ed9d13">&#39;.model&#39;</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">global_step=step)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">load</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">checkpoint_dir):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">re</span>
        <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Reading checkpoints...&quot;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">checkpoint_dir</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_dir,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.model_name)</span>

        <span style="color: #d0d0d0">ckpt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">tf.train.get_checkpoint_state(checkpoint_dir)</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">ckpt</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">ckpt.model_checkpoint_path:</span>
            <span style="color: #d0d0d0">ckpt_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(ckpt.model_checkpoint_path)</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.saver.restore(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.sess,</span> <span style="color: #d0d0d0">os.path.join(checkpoint_dir,</span> <span style="color: #d0d0d0">ckpt_name))</span>
            <span style="color: #d0d0d0">counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">next</span><span style="color: #d0d0d0">(re.finditer(</span><span style="color: #ed9d13">&quot;(\d+)(?!.*\d)&quot;</span><span style="color: #d0d0d0">,ckpt_name)).group(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">))</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Success to read {}&quot;</span><span style="color: #d0d0d0">.format(ckpt_name))</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">True</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">counter</span>
        <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot; [*] Failed to find a checkpoint&quot;</span><span style="color: #d0d0d0">)</span>
            <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span>
</pre></td></tr></table></div>

                            </div>
                        </div>
                </li>

            </ul>

        </section>

        
    </div>

    <!-- SITE DESCRIPTION -->
    <div class="break" id="site-description">
        <h2>site description</h2>
        <section>

        </section>
    </div>

    <!-- ANNOTATED BIBLIOGRAPHY -->
    <div class="break" id="annotated-bibliography">
        <h2>annotated bibliography</h2>
        <section>
            <p>Primary Sources have been grouped based off of three primary areas of research: Design Theory, Machine
                Learning, and Computer Graphics / Computer-Aided-Design Systems. A fourth area cites the software
                tools, code and open-source projects used or referenced throughout the thesis</p>
        </section>

        <h3>Design Theory</h3>
        <section>
            <ul class="bib-section">
                <!-- Architectural Intelligence: How Designers and Architects Created the Digital Landscape -->
                <li class="bib-entry">
                    <p><em>Architectural Intelligence: How Designers and Architects Created the Digital Landscape </em>Molly
                        Wright Steenson - <a href="https://www.amazon.com/gp/product/0262037068/ref=dbs_a_def_rwt_hsch_vapi_taft_p1_i0"
                            target="_blank">The MIT Press, 2017</a></p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- The Perceptron: A Probabilistic Model for Information Storage and Organization in The Brain -->
                <li class="bib-entry">
                    <p><em>The Perceptron: A Probabilistic Model for Information Storage and Organization in The Brain
                        </em>F. Rosenblatt - <a href="http://citeseerx.ist.psu.edu/viewdoc/citations?doi=10.1.1.588.3775"
                            target="_blank">Psychological Review, 1958</a></p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- An Urban Farming Paradigm Resilient to Energy Descent for Singapore -->
                <li class="bib-entry">
                    <p><em>An Urban Farming Paradigm Resilient to Energy Descent for Singapore </em>Kaushik, Vignesh -
                        <a href="https://wowad.in/evolutionary-design-process/" target="_blank">Masters’ thesis,
                            National University of Singapore. 2012</a></p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Inceptionism: Going Deeper into Neural Networks -->
                <li class="bib-entry">
                    <p><em>Inceptionism: Going Deeper into Neural Networks </em>Alexander Mordvintsev, Christopher
                        Olah, Mike Tyka - <a href="https://ai.googleblog.com/2015/06/inceptionism-going-deeper-into-neural.html"
                            target="_blank">Google AI Blog. 2015</a></p>

                    <p class="anno">TODO: annotation</p>
                </li>

            </ul>
        </section>

        <h3>Machine Learning</h3>
        <section>
            <ul class="bib-section">
                <!-- Generative Adversarial Networks -->
                <li class="bib-entry">
                    <p><em>Generative Adversarial Networks </em>Ian J. Goodfellow, Jean Pouget-Abadie, Mehdi Mirza,
                        Bing Xu, David Warde-Farley, Sherjil Ozair, Aaron Courville, Yoshua Bengio - <a href="https://arxiv.org/abs/1406.2661"
                            target="_blank">arXiv:1406.2661</a> [stat.ML]</p>
                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- NIPS 2016 Tutorial: Generative Adversarial Networks -->
                <li class="bib-entry">
                    <p><em>NIPS 2016 Tutorial: Generative Adversarial Networks </em>Ian Goodfellow - <a href="https://arxiv.org/abs/1701.00160"
                            target="_blank">arXiv:1701.00160</a> [cs.LG]</p>

                    <p class="anno">This report summarizes the tutorial presented by the author at NIPS 2016 on
                        generative adversarial networks (GANs). The tutorial describes: (1) Why generative modeling is
                        a topic worth studying, (2) how generative models work, and how GANs compare to other
                        generative models, (3) the details of how GANs work, (4) research frontiers in GANs, and (5)
                        state-of-the-art image models that combine GANs with other methods. Finally, the tutorial
                        contains three exercises for readers to complete, and the solutions to these exercises.</p>
                </li>

                <!-- Learning to Generate Chairs, Tables and Cars with Convolutional Networks -->
                <li class="bib-entry">
                    <p><em>Learning to Generate Chairs, Tables and Cars with Convolutional Networks </em>Alexey
                        Dosovitskiy, Jost Tobias Springenberg, Maxim Tatarchenko, Thomas Brox - <a href="https://arxiv.org/abs/1411.5928"
                            target="_blank">arXiv:1411.5928</a> [cs.CV]</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Unsupervised Representation Learning with Deep Convolutional Generative Adversarial Networks -->
                <li class="bib-entry">
                    <p><em>Unsupervised Representation Learning with Deep Convolutional Generative Adversarial Networks
                        </em>Alec Radford, Luke Metz, Soumith Chintala - <a href="https://arxiv.org/abs/1511.06434"
                            target="_blank">arXiv:1511.06434</a> [cs.LG]</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- InfoGAN: Interpretable Representation Learning by Information Maximizing Generative Adversarial Nets -->
                <li class="bib-entry">
                    <p><em>InfoGAN: Interpretable Representation Learning by Information Maximizing Generative
                            Adversarial Nets </em>Xi Chen, Yan Duan, Rein Houthooft, John Schulman, Ilya Sutskever,
                        Pieter Abbeel - <a href="https://arxiv.org/abs/1606.03657" target="_blank">arXiv:1606.03657</a>
                        [cs.LG]</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- 3D ShapeNets: A Deep Representation for Volumetric Shapes -->
                <li class="bib-entry">
                    <p><em>3D ShapeNets: A Deep Representation for Volumetric Shapes </em>Zhirong Wu, Shuran Song,
                        Aditya Khosla, Fisher Yu, Linguang Zhang, Xiaoou Tang, Jianxiong Xiao - <a href="https://arxiv.org/abs/1406.5670"
                            target="_blank">arXiv:1406.5670</a> [cs.CV]</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Improved Techniques for Training GANs -->
                <li class="bib-entry">
                    <p><em>Improved Techniques for Training GANs </em>Tim Salimans, Ian Goodfellow, Wojciech Zaremba,
                        Vicki Cheung, Alec Radford, Xi Chen - <a href="https://arxiv.org/abs/1606.03498" target="_blank">arXiv:1606.03498</a>
                        [cs.LG] 2016</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Deep Learning (Adaptive Computation and Machine Learning series) -->
                <li class="bib-entry">
                    <p><em>Deep Learning </em>Ian Goodfellow, Yoshua Bengio, Aaron Courville, Francis Bach - <a href="https://www.amazon.com/Deep-Learning-NONE-Ian-Goodfellow-ebook/dp/B01MRVFGX4"
                            target="_blank">The MIT Press. 2016</a></p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Wasserstein GAN -->
                <li class="bib-entry">
                    <p><em>Wasserstein GAN </em>Martin Arjovsky, Soumith Chintala, Léon Bottou - <a href="https://arxiv.org/abs/1701.07875"
                            target="_blank">arXiv:1701.07875</a> [stat.ML] 2017</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- On Convergence and Stability of GANs -->
                <li class="bib-entry">
                    <p><em>On Convergence and Stability of GANs </em>Naveen Kodali, Jacob Abernethy, James Hays, Zsolt
                        Kira - <a href="https://arxiv.org/abs/1705.07215" target="_blank">arXiv:1705.07215</a> [cs.AI]
                        2017</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Energy-based Generative Adversarial Network -->
                <li class="bib-entry">
                    <p><em>Energy-based Generative Adversarial Network </em>Junbo Zhao, Michael Mathieu, Yann LeCun -
                        <a href="https://arxiv.org/abs/1609.03126" target="_blank">arXiv:1609.03126</a> [cs.LG] 2017</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Least Squares Generative Adversarial Networks -->
                <li class="bib-entry">
                    <p><em>Least Squares Generative Adversarial Networks </em>Xudong Mao, Qing Li, Haoran Xie, Raymond
                        Y.K. Lau, Zhen Wang, Stephen Paul Smolley - <a href="https://arxiv.org/abs/1611.04076" target="_blank">arXiv:1611.04076</a>
                        [cs.CV] 2017</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Improved Training of Wasserstein GANs -->
                <li class="bib-entry">
                    <p><em>Improved Training of Wasserstein GANs </em>Ishaan Gulrajani, Faruk Ahmed, Martin Arjovsky,
                        Vincent Dumoulin, Aaron Courville - <a href="https://arxiv.org/abs/1704.00028" target="_blank">arXiv:1704.00028</a>
                        [cs.LG] 2017</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Conditional Generative Adversarial Nets -->
                <li class="bib-entry">
                    <p><em>Conditional Generative Adversarial Nets </em>Mehdi Mirza, Simon Osindero - <a href="https://arxiv.org/abs/1411.1784"
                            target="_blank">arXiv:1411.1784</a> [cs.LG] 2014</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Conditional Image Synthesis With Auxiliary Classifier GANs -->
                <li class="bib-entry">
                    <p><em>Conditional Image Synthesis With Auxiliary Classifier GANs </em>Augustus Odena, Christopher
                        Olah, Jonathon Shlens - <a href="https://arxiv.org/abs/1610.09585" target="_blank">arXiv:1610.09585</a>
                        [stat.ML] 2017</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Boundary-Seeking Generative Adversarial Networks -->
                <li class="bib-entry">
                    <p><em>Boundary-Seeking Generative Adversarial Networks </em>R Devon Hjelm, Athul Paul Jacob, Tong
                        Che, Adam Trischler, Kyunghyun Cho, Yoshua Bengio - <a href="https://arxiv.org/abs/1702.08431"
                            target="_blank">arXiv:1702.08431</a> [stat.ML] 2018</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- An Orchestrated Empirical Study on Deep Learning Frameworks and Platforms -->
                <li class="bib-entry">
                    <p><em>An Orchestrated Empirical Study on Deep Learning Frameworks and Platforms </em>Qianyu Guo,
                        Xiaofei Xie, Lei Ma, Qiang Hu, Ruitao Feng, Li Li, Yang Liu, Jianjun Zhao, Xiaohong Li - <a
                            href="https://arxiv.org/abs/1811.05187" target="_blank">arXiv:1811.05187</a> [cs.LG] 2018</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- A framework for remote sensing images processing using deep learning technique -->
                <li class="bib-entry">
                    <p><em>A framework for remote sensing images processing using deep learning technique </em>Rémi
                        Cresson - <a href="https://arxiv.org/abs/1807.06535" target="_blank">arXiv:1807.06535</a>
                        [cs.CV] 2018</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- The GAN Landscape: Losses, Architectures, Regularization, and Normalization -->
                <li class="bib-entry">
                    <p><em>The GAN Landscape: Losses, Architectures, Regularization, and Normalization </em>Karol
                        Kurach, Mario Lucic, Xiaohua Zhai, Marcin Michalski, Sylvain Gelly - <a href="https://arxiv.org/abs/1807.04720"
                            target="_blank">arXiv:1807.04720</a> [cs.LG] 2018</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Laplacian Smoothing Gradient Descent -->
                <li class="bib-entry">
                    <p><em>Laplacian Smoothing Gradient Descent </em>Stanley Osher, Bao Wang, Penghang Yin, Xiyang Luo,
                        Minh Pham, Alex Lin - <a href="https://arxiv.org/abs/1806.06317" target="_blank">arXiv:1806.06317</a>
                        [cs.LG] 2018</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Neural Networks for Beginners. A fast implementation in Matlab, Torch, TensorFlow -->
                <li class="bib-entry">
                    <p><em>Neural Networks for Beginners. A fast implementation in Matlab, Torch, TensorFlow </em>Francesco
                        Giannini, Vincenzo Laveglia, Alessandro Rossi, Dario Zanca, Andrea Zugarini - <a href="https://arxiv.org/abs/1703.05298"
                            target="_blank">arXiv:1703.05298</a> [cs.LG] 2017</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- A Tour of TensorFlow -->
                <li class="bib-entry">
                    <p><em>A Tour of TensorFlow </em>Peter Goldsborough - <a href="https://arxiv.org/abs/1610.01178"
                            target="_blank">arXiv:1610.01178</a> [cs.LG] 2016</p>

                    <p class="anno">TODO: annotation</p>
                </li>


            </ul>
        </section>

        <h3>Computer Graphics & CAD Systems</h3>
        <section>
            <ul class="bib-section">
                <!-- 3D Sketching using Multi-View Deep Volumetric Prediction -->
                <li class="bib-entry">
                    <p><em>3D Sketching using Multi-View Deep Volumetric Prediction </em>Johanna Delanoy, Mathieu
                        Aubry, Phillip Isola, Alexei A. Efros, Adrien Bousseau - <a href="https://arxiv.org/abs/1707.08390"
                            target="_blank">arXiv:1707.08390</a> [cs.GR]</p>

                    <p class="anno">TODO: annotation</p>
                </li>

                <!-- Computer-Generated Residential Building Layouts -->
                <li class="bib-entry">
                    <p><em>Computer-Generated Residential Building Layouts </em>Paul Merrell, Eric Schkufza, Vladlen
                        Koltun - <a href="http://vladlen.info/publications/computer-generated-residential-building-layouts/"
                            target="_blank">ACM Transactions on Graphics 29(6), 2010</a></p>

                    <p class="anno">TODO: annotation</p>
                </li>


            </ul>
        </section>

        <h3>Software Tools and Code</h3>
        <section>
            <ul class="bib-section">
                <!-- Jupyter -->
                <li class="bib-entry">
                    <p><em>Jupyter </em>Damian Avila, Matthias Bussonnier, Sylvain Corlay, Brian Granger, Jason Grout -
                        <a href="https://jupyter.org/" target="_blank">Jupyter Project and Community</a></p>

                    <p class="anno">The Jupyter Notebook is an open-source web application that allows you to create
                        and share documents that contain live code, equations, visualizations and narrative text. Uses
                        include: data cleaning and transformation, numerical simulation, statistical modeling, data
                        visualization, machine learning, and much more.</p>
                </li>

                <!-- Python -->
                <li class="bib-entry">
                    <p><em>Python </em>Guido van Rossum - <a href="https://www.python.org/" target="_blank">Python
                            Software Foundation. 2011 - 2018</a></p>

                    <p class="anno">Python is an interpreted, high-level programming language for general-purpose
                        programming. Created by Guido van Rossum and first released in 1991, Python has a design
                        philosophy that emphasizes code readability, notably using significant whitespace. It provides
                        constructs that enable clear programming on both small and large scales.</p>
                </li>

                <!-- Keras -->
                <li class="bib-entry">
                    <p><em>Keras </em>François Chollet - <a href="https://keras.io/" target="_blank">Keras-team. 2015</a></p>

                    <p class="anno">Keras is a high-level neural networks API, written in Python and capable of running
                        on top of TensorFlow, CNTK, or Theano. It was developed with a focus on enabling fast
                        experimentation. Being able to go from idea to result with the least possible delay is key to
                        doing good research.</p>
                </li>

                <!-- Tensorflow -->
                <li class="bib-entry">
                    <p><em>Tensorflow </em>Google Brain Team - <a href="https://www.tensorflow.org/" target="_blank">Google-tensorflow.
                            2015 - 2018</a></p>

                    <p class="anno">TensorFlow is an open-source software library for dataflow programming across a
                        range of tasks. It is a symbolic math library, and is also used for machine learning
                        applications such as neural networks. It is used for both research and production at Google.‍</p>
                </li>

                <!-- cuDNN 7.4 -->
                <li class="bib-entry">
                    <p><em>cuDNN 7.4 </em>Nvidia Corporation - <a href="https://developer.nvidia.com/cudnn" target="_blank">Nvidia
                            cuDNN - GPU Accelerated Deep Learning. 2017</a></p>

                    <p class="anno">The NVIDIA CUDA Deep Neural Network library (cuDNN) is a GPU-accelerated library of
                        primitives for deep neural networks. cuDNN provides highly tuned implementations for standard
                        routines such as forward and backward convolution, pooling, normalization, and activation
                        layers. </p>
                </li>


            </ul>
        </section>


    </div>

    <!-- GLOSSARY -->
    <div class="break" id="glossary">
        <h2>glossary</h2>
        <section>

        </section>
    </div>

</body>

</html>